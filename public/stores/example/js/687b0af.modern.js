(window.webpackJsonp=window.webpackJsonp||[]).push([[362,99,120],{477:function(t,e,r){"use strict";r(19);e.a={computed:{isMobile:()=>!1}}},478:function(t,e,r){"use strict";r.r(e);var o={name:"DesignCustomerArtworks",components:{CustomerArtworks:()=>r.e(23).then(r.bind(null,942)),CustomerArtworksGrid:()=>r.e(27).then(r.bind(null,1217))},props:{artworks:{type:Array,required:!0}},data:()=>({isListMode:!0}),methods:{toggleListMode(){this.isListMode=!this.isListMode}}},n=r(42),component=Object(n.a)(o,(function(){var t=this,e=t._self._c;return t.imported?e("div",[e("div",{staticClass:"d-flex justify-content-end"},[e("div",{staticClass:"btn-group"},[e("button",{staticClass:"btn",class:[t.isListMode?"btn-primary":"btn-light"],on:{click:function(e){return t.toggleListMode()}}},[e("i",{staticClass:"fas fa-list fa-fw"})]),t._v(" "),e("button",{staticClass:"btn",class:[t.isListMode?"btn-light":"btn-primary"],on:{click:function(e){return t.toggleListMode()}}},[e("i",{staticClass:"fas fa-th-large fa-fw"})])])]),t._v(" "),t.isListMode?e("CustomerArtworks",{attrs:{artworkFiles:t.artworks,"has-add-btn":!0,editable:!1},on:{add:function(e){return t.$emit("add",e)}}}):e("CustomerArtworksGrid",{staticClass:"row my-2",attrs:{images:t.artworks},on:{add:function(e){return t.$emit("add",e)}}})],1):t._e()}),[],!1,null,null,null);e.default=component.exports},479:function(t,e,r){"use strict";r.r(e);var o=r(527),n=(r(528),{components:{Hooper:o.a,HooperNavigation:o.b,Slide:o.d},props:{images:{type:Array,required:!0},activeImage:{type:String}},methods:{onSelectImage(image){this.$emit("select",image)}}}),l=r(42),component=Object(l.a)(n,(function(){var t=this,e=t._self._c;return e("div",[e("hooper",{ref:"carousel",staticClass:"hooper-flush mt-3",attrs:{itemsToShow:7,itemsToSlide:6,pagination:"no"}},[t._l(t.images,(function(image){return e("slide",{key:image.urlSmall},[e("div",{staticClass:"square",class:{"active-hooper":image.url===t.activeImage}},[e("NuxtImg",{directives:[{name:"lazy",rawName:"v-lazy",value:image.urlSmall,expression:"image.urlSmall"}],staticClass:"img-fluid pointer p-2 bg-white",on:{click:function(e){return t.onSelectImage(image)}}})],1)])})),t._v(" "),e("hooper-navigation",{staticStyle:{width:"95%"},attrs:{slot:"hooper-addons"},slot:"hooper-addons"})],2)],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{NuxtImg:r(416).default})},500:function(t,e,r){"use strict";(function(t){r(2);var o=r(0),n=r(1),l=(r(13),r(8),r(7),r(501)),d=r(540),c=r(508),m=r(478),f=r(479),h=r(482),v=r(489),k=r(477),w=r(510),I=r(454);function C(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function D(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?C(Object(r),!0).forEach((function(e){Object(o.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var y=r(37);e.a={data:()=>({loaded:!1,customer:{},error:""}),mixins:[v.a,k.a,w.a,I.a],components:{Preloader:c.default,ProductHeader:l.default,FormConfigure:d.default,DesignImages:f.default,DesignCustomerArtworks:m.default,Signin:h.default},props:{productData:Object,configureProduct:Object,isModal:Boolean},methods:{onConfirmConfigureProduct(data){return this.isModal?this.$emit("confirmConfigure"):this.confirmConfigureProduct(data)},checkListArtworks(t){if(t.length&&this.storeInformation.matchNumberDecorationColorsWithNumberArtworkColors){var e=this.productData.locations.map((t=>t.decorations.find((t=>t._id===this.$refs.form.productDecorationId)))).find((t=>t));return null!=e&&e.decoration_units_included?t.filter((t=>(t.colorsNumber||[]).find((t=>parseInt((t||0).toString())<=parseInt(e.decoration_units_included.toString()))))):t}return t},checkPageWalkthroughs(){var e=this;return Object(n.a)((function*(){var r=yield e.$api.walkthroughs.getPageWalkthrough({category:"Store",storeId:e.storeInformation._id,type:"Step",page:"Designer"}),o=y.getJSON("completedWalkthroughs")||[];if(r){var l=r.steps.map((i=>{var element=document.querySelector(".".concat(i.className)),t=!element;return element&&(t=0===element.getClientRects().length),{title:i.title,intro:i.content,tooltipClass:i.tooltipClass,position:i.position,element:element,hidden:t}})).filter((i=>!i.hidden)),d=t.cloneDeep(e.loggedInCustomer||{}),c=e;d.completedWalkthroughs||(d.completedWalkthroughs=[]),d.completedWalkthroughs.includes(r._id)||o.includes(r._id)||e.mPowerIntroJs().then((t=>t.onbeforeexit(Object(n.a)((function*(){d._id&&(d.completedWalkthroughs.push(r._id),c.$api.customers.updateCustomer(d),y.remove("completedWalkthroughs")),y.set("completedWalkthroughs",JSON.stringify([r._id]))}))).setOptions({steps:l}).start()))}}))()},removeFromDesigner(t){try{this.$refs.form.orderData.artworkFilesV1=(this.$refs.form.orderData.artworkFilesV1||[]).filter((e=>e.tempId!==t.id))}catch(t){}},addToDesigner(){var t=arguments,e=this;return Object(n.a)((function*(){var{image:image,object:object}=t.length>0&&void 0!==t[0]?t[0]:{};if(null==image||!image.classTypes||((null==image?void 0:image.classTypes)||[]).find((t=>"Logo"===t.class_type_name))||image.storeId){e.$refs.form.orderData.artworkFilesV1||(e.$refs.form.orderData.artworkFilesV1=[]),image.tempId=object.id;var r=image.url||image.location||"";e.$refs.form.orderData.artworkFilesV1.push(D(D({},image),{},{fileName:r.split("/")[r.split("/").length-1],fileLocation:r}))}}))()},onLoad(){var t=this;return Object(n.a)((function*(){var e;if(t.loaded=t.$refs.form&&t.$refs.form.loaded&&(!t.$refs.designer||(null===(e=t.$refs.designer.$refs)||void 0===e||null===(e=e.imageEditor)||void 0===e?void 0:e.loaded)),t.$refs.form.orderData.LineItemArray&&t.$refs.form.orderData.LineItemArray[0].designerConfig){var r,o=t.$refs.form.orderData.LineItemArray[0].designerConfig,{designerBackground:n}=(yield null===(r=t.$refs.designer)||void 0===r||null===(r=r.$refs)||void 0===r||null===(r=r.imageEditor)||void 0===r?void 0:r.resetFromJSON(o))||{};n&&t.updateDesignerBackground(n,!0)}}))()},onSelectPart(t){this.selectedPart(t),setTimeout((()=>{this.$refs.carousel&&this.$refs.carousel.slideTo(0)})),this.updateLocationDesignerBackground()},onSelectImage(image){var t;this.updateDesignerImage(image);var{location:e}=this.imprintAreas.find((t=>{var{location:e}=t;return!!e}))||{},{defaultDecoration:r}=(null===(t=this.$refs)||void 0===t||null===(t=t.form)||void 0===t||null===(t=t.$refs)||void 0===t||null===(t=t.decoration)||void 0===t?void 0:t.$refs)||{};if(e&&e!==this.selectedLocationId&&r){var o=(r._locations||[]).find((t=>{var{value:r}=t;return r===e}));o&&r.selectLocation(o)}},updateLocationDesignerBackground(){var t,e=(null===(t=this.part)||void 0===t?void 0:t.mediaList)||[],image=this.selectedLocationId&&e.find((t=>{var{imprintAreas:e}=t;return(e||[]).some((t=>{var{location:e}=t;return e===this.selectedLocationId}))}));try{var r;if(!image&&this.selectedLocationId)image=null===(r=this.productData.locations.find((t=>t._id===this.selectedLocationId)))||void 0===r||null===(r=r.mappings)||void 0===r?void 0:r.map((t=>t.groups.map((g=>e.find((i=>i.classTypes.find((t=>g===t.class_type_id)))))).find((t=>t)))).find((t=>t))}catch(t){console.log(t)}image||(image=this.blankImages.find((t=>t.url))),image||(image=this.productImages.filter((t=>t.url||t.imgUrl))[0]),image&&(!this.configureProduct.blankCanvasIfNoBlankImages||this.blankSelectedPartImages.length>0)&&this.updateDesignerImage(image)},signIn(){var t=this;return Object(n.a)((function*(){yield t.$refs.signIn.$validator.validateAll(),t.$refs.signIn.formIsInvalidMessage?t.error=t.$refs.signIn.formIsInvalidMessage:(yield t.logIn(D(D({},t.customer),{},{storeUrl:t.storeInformation.storeUrl}),!0),yield t.loadCustomerArtworks())}))()}},computed:{defaultArtworksV1(){return this.checkListArtworks(this.defaultArtworks)},customerArtworksV1(){return this.checkListArtworks(this.configureProduct.allowCustomerArtwork?this.customerArtworks:[])},selectedLocationId(){var t;return null===(t=this.defaultDecoration)||void 0===t||null===(t=t.location)||void 0===t?void 0:t._id},imprintArea(){var t=this.imprintAreas[0];return this.imprintAreas.find((t=>{var{location:e}=t;return e&&e===this.selectedLocationId}))||t},visibleControls(){return!["allowCustomArtwork","allowCustomText","allowEditing","showBlankCanvas","showAdditionalImages","showImprintAreaBox","setDesignAsDefaultImage","doNotSaveDesign"].find((t=>void 0!==this.designerConfig[t]))||(this.designerConfig.allowCustomText||this.designerConfig.allowCustomArtwork)},_defaultDecoration(){return this.designerBackground?null:this.defaultDecoration||{}},selectedColor(){return this.$refs.form&&this.$refs.form.selectedColor},fromOrderPresentation(){return this.$route.query.presentation},designerProductData(){return D(D({},this.productData||{}),{},{defaultDecoration:this._defaultDecoration,imgUrl:this.designerBackground})}},watch:{selectedLocationId(){this.updateLocationDesignerBackground()}},mounted(){var t=this;return Object(n.a)((function*(){t.selectedLocationId&&t.updateLocationDesignerBackground(),t.storeInformation.showWalkthroughs&&setTimeout(Object(n.a)((function*(){yield t.checkPageWalkthroughs()})),3e3)}))()}}}).call(this,r(61))},508:function(t,e,r){"use strict";r.r(e);var o=r(42),component=Object(o.a)({},(function(){this._self._c;return this._m(0)}),[function(){var t=this._self._c;return t("div",{staticClass:"center-spinner text-center w-100 d-flex align-self-center justify-content-center",staticStyle:{"z-index":"1111",background:"rgba(255,255,255,0.2)",height:"100%"}},[t("i",{staticClass:"far fa-spinner-third fa-spin fa-3x text-primary"})])}],!1,null,null,null);e.default=component.exports},510:function(t,e,r){"use strict";r(2);var o=r(1),n=r(0),l=(r(9),r(10),r(4)),d=r(18),c=r(535),m=r(433);function f(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function h(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?f(Object(r),!0).forEach((function(e){Object(n.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}e.a={data:()=>({part:null,designerImported:!1,withBackgroundImage:!1,storeArtworks:[],customerArtworks:[],blankSelectedPartImages:[],imprintAreas:[],designerBackground:null,fillColorUplodedImages:null,intervalId:null,activeAreaBackgroundImage:"https://mpower-store-media-prod.s3.amazonaws.com/assets/transparentpng-transparent-png-500_500.png"}),computed:h(h({},Object(d.c)({storeInformation:"storeInformation",loggedInCustomer:"auth/loggedInUser"})),{},{productImages(){var t,e;this.productData.parts.find((t=>{var e;return null===(e=t.mediaList)||void 0===e?void 0:e.length}))||(e=this.productData.imageDefault);var r=this.productData.parts;if(null!==(t=this.part)&&void 0!==t&&t.colorName){var o=this.productData.parts.filter((t=>t.colorName===this.part.colorName));o.find((t=>{var e,r;return(null===(e=t.mediaList)||void 0===e?void 0:e.length)||(null===(r=t.image)||void 0===r?void 0:r._id)}))&&(r=o)}return Object(c.b)(r,e,!0,this.productData.supplierId)},defaultArtworks(){var t,e=(null===(t=this.part)||void 0===t?void 0:t.mediaList.filter((i=>Object(m.d)(i,"Logo"))))||[];return e.length>0?e:this.storeArtworks},hasBlankImages(){return this.blankImages.length>0},designerConfig(){return h({allowEditing:!1,showImprintAreaBox:!1,allowCustomArtwork:!1,allowCustomText:!1,showAdditionalImages:!1},this.configureProduct.designer||{})},blankImages(){var t,e=[];e=this.part&&null!==(t=this.productData.supplierId)&&void 0!==t&&null!==(t=t.imagesClassTypesOrder)&&void 0!==t&&t.length?Object(c.b)([this.part],null,!0,this.productData.supplierId).filter((t=>t.url||t.imgUrl)):this.blankSelectedPartImages.length?this.blankSelectedPartImages:this.productImages;var r=h(h({},this.productData.supplierId||{}),{},{mediaTypePriority:this.storeInformation.productImagesOrder});return[this.activeAreaBackgroundImage&&this.designerConfig.showBlankCanvas?{urlSmall:this.activeAreaBackgroundImage,url:null}:null,...Object(c.c)(e,[],r).list||[]].filter((i=>!!i))},hasImprintArea(){return this.imprintAreas.length>0}}),created(){var t=this;return Object(o.a)((function*(){t.designerImported||(yield t.importDesigner(),t.intervalId=setInterval((()=>{t.designerImported?clearInterval(t.intervalId):t.importDesigner()}),100))}))()},destroyed(){clearInterval(this.intervalId)},mounted(){var t=this;return Object(o.a)((function*(){t.storeArtworks=yield t.$api.stores.getStoreArtworks(t.storeInformation._id),t.loadCustomerArtworks()}))()},methods:{importDesigner(){var t=this;return Object(o.a)((function*(){if(!t.importingDesigner){t.importingDesigner=!0;try{var e=yield r.e(381).then(r.t.bind(null,577,7));l.default.use(e.default,{API_TOKEN:"iJbIgcZaS0xwdVTkzAfe8jzqM8YmHmUF",API_URL:"https://api.mpowerpromo.com"}),t.designerImported=!0}catch(t){console.error("Failed to import MpowerDesigner:",t)}finally{t.importingDesigner=!1}}}))()},onSubmitWithoutJson(){return this.onSubmit(!0)},loadCustomerArtworks(){var t=this;return Object(o.a)((function*(){t.loggedInCustomer&&(t.customerArtworks=yield t.$api.customers.getCustomerArtworks(t.loggedInCustomer._id))}))()},onSubmit(t){var e=this;return Object(o.a)((function*(){if(e.$refs.designer){var r=e.$refs.designer.$refs.imageEditor.editor.toJSON(["lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY","lockUniScaling","comments","fileName","fillColor","removedBackground","selectable"]);return e.designerBackground?r.designerBackground=e.designerBackground:delete r.designerBackground,{json:t?null:r,preview:yield e.$refs.designer.$refs.imageEditor.editor.export({upLoadOnly:!0,ext:"png",image:e.designerBackground})}}}))()},selectedPart(t){this.part=t;var{mediaList:e=[]}=t;this.blankSelectedPartImages=[...e.filter((t=>Object(m.d)(t,"Blank"))).reduce(((t,image)=>(t.set(image.url,image),t)),new Map).values()]},updateDesignerImage(image){var t,e=null;null==image||null===(t=image.layers)||void 0===t||t.forEach((t=>{null==t||t.LayerOrStopArray.forEach((t=>{var{hexCode:r}=t;r&&(e=r)}))})),this.fillColorUplodedImages=e,this.imprintAreas=(null==image?void 0:image.imprintAreas)||[],this.updateDesignerBackground((null==image?void 0:image.url)||(null==image?void 0:image.imgUrl)||null,!!image)},updateDesignerBackground(t,e){this.designerBackground=t,this.withBackgroundImage=e},addArtworkToDesigner(t){this.$refs.designer&&this.$refs.designer.addArtwork(t)}}}},721:function(t,e,r){"use strict";r.r(e);var o=r(500).a,n=r(42),component=Object(n.a)(o,(function(){var t=this,e=t._self._c;return e("div",{class:t.configureProduct.class||"container-max py-3"},[t.isModal?t._e():[t.fromOrderPresentation?e("nuxt-link",{staticClass:"small text-muted",attrs:{to:"/presentation/".concat(t.fromOrderPresentation)}},[e("i",{staticClass:"far fa-angle-left mr-2"}),t._v(" Back to Presentation\n    ")]):t.productData?e("nuxt-link",{staticClass:"small text-muted",attrs:{to:t.backProductUrl}},[e("i",{staticClass:"far fa-angle-left mr-2"}),t._v(" Back to Product\n    ")]):t._e()],t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-lg-7 mb-3 pt-4"},[t.designerConfig.showAdditionalImages?e("div",{staticClass:"px-3 pb-3 card intro-designer-images-list"},[t.loaded&&t.hasBlankImages?e("DesignImages",{attrs:{images:t.blankImages,activeImage:t.designerBackground},on:{select:t.onSelectImage}}):t._e()],1):t._e(),t._v(" "),e("div",{staticClass:"py-3 sticky-top intro-designer"},[e("client-only",[t.designerImported?e("mpower-designer",{ref:"designer",attrs:{defaultArtworks:t.defaultArtworksV1,customerArtworks:t.customerArtworksV1,bucketToSave:"orders/designer/",product:t.designerProductData,decoration:t._defaultDecoration,"imprint-area":t.imprintArea,canUploadImage:!t.storeInformation.disableUploadImages,activeAreaBackgroundImage:t.activeAreaBackgroundImage,withBackgroundImage:t.withBackgroundImage,exportProductImage:t.withBackgroundImage,canEditImage:t.designerConfig.allowCustomArtwork,drawImprintAreaBox:t.designerConfig.showImprintAreaBox,canAddText:t.designerConfig.allowCustomText,visibleControls:t.designerConfig.allowCustomText||t.designerConfig.allowCustomArtwork||t.visibleControls,canSelect:!!t.designerConfig.allowEditing,autoOpenColorPicker:t.designerConfig.autoOpenColorPicker,clearBgUplodedImages:t.productData.designerRemoveBgImage,fillColorUplodedImages:t.fillColorUplodedImages},on:{onLoad:t.onLoad,add:t.addToDesigner,remove:t.removeFromDesigner},scopedSlots:t._u([{key:"customer-artworks",fn:function(r){var{customerArtworks:o}=r;return[!t.loggedInCustomer&&t.configureProduct.showSigninInArtworkModal?e("div",{staticClass:"card mt-2 p-3 bg-light"},[e("div",{staticClass:"h5 mb-3 text-center"},[t._v("Sign in to view saved artwork")]),t._v(" "),e("signin",{ref:"signIn",attrs:{customerData:t.customer,error:t.error,loading:t.loading},on:{signin:t.signIn}})],1):o&&o.length?e("DesignCustomerArtworks",{attrs:{artworks:o},on:{add:function(e){return t.addArtworkToDesigner(e)}}}):t._e()]}}],null,!1,2208282508)},[e("div",{staticClass:"w-100 justify-content-center p-3",attrs:{slot:"description"},slot:"description"},[e("div",[e("i",{staticClass:"far fa-alert"})]),t._v(" "),e("div",{staticClass:"mx-auto"},[e("h4",[t._v("Add text or artwork to start designing")]),t._v(" "),e("div",{staticClass:"w-100 w-md-50 mx-auto"},[t.configureProduct.designerDescription?e("div",[t._v(t._s(t.configureProduct.designerDescription))]):t._e()])])])]):e("div",{staticClass:"d-flex justify-content-center mt-2"},[e("i",{staticClass:"far fa-spinner-third fa-spin"})])],1)],1)]),t._v(" "),e("div",{staticClass:"col-lg-5"},[t.productData?e("div",{staticClass:"pt-3"},[e("ProductHeader",{attrs:{"product-data":t.productData}})],1):t._e(),t._v(" "),e("client-only",[e("FormConfigure",{ref:"form",attrs:{startFrom:2,onSubmit:t.onSubmit,productData:t.productData,configureProduct:t.configureProduct},on:{onLoad:t.onLoad,submitCart:function(e){return t.$emit("submitCart")},confirmConfigureProduct:t.onConfirmConfigureProduct,selectedPart:t.onSelectPart}})],1)],1)])],2)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{DesignImages:r(479).default,DesignCustomerArtworks:r(478).default,ProductHeader:r(501).default})}}]);